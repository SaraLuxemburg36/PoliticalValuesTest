<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Risultati - Test Politico</title>
  <style>
    body {
      background-color: #f3f3f3;
      font-family: "Inter", Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    h1 {
      margin-bottom: 14px;
      color: #222;
    }
    .frame {
      background: white;
      padding: 20px;
      border-radius: 14px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.1);
      text-align: center;
    }
    canvas {
      border: 2px solid #333;
      background: #fafafa;
      display: block;
      width: 500px;
      height: 500px;
      max-width: 100%;
      margin: 0 auto;
    }
    .values {
      margin-top: 14px;
      font-size: 1rem;
      color: #222;
      display: flex;
      justify-content: center;
      gap: 20px;
    }
    #download-btn {
      margin-top: 16px;
      padding: 10px 18px;
      font-size: 1rem;
      background-color: #222;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    #download-btn:hover {
      background-color: #444;
    }
    @media (max-width: 520px) {
      canvas { width: 320px; height: 320px; }
    }
  </style>
</head>
<body>
  <h1>Risultati del Test Politico</h1>

  <div class="frame">
    <canvas id="compass" width="2000" height="2000"></canvas>
    <div class="values">
      <div>Economico (X): <strong id="x-val">0.00</strong></div>
      <div>Politico (Y): <strong id="y-val">0.00</strong></div>
    </div>
    <button id="download-btn">Scarica immagine</button>
  </div>

  <script>
    // Recupera coordinate memorizzate (già scalate -10..+10)
    let xCoord = parseFloat(localStorage.getItem("userX")) || 0;
    let yCoord = parseFloat(localStorage.getItem("userY")) || 0;

    // Reimponiamo i limiti (per sicurezza)
    if (xCoord > 10) xCoord = 10;
    if (xCoord < -10) xCoord = -10;
    if (yCoord > 10) yCoord = 10;
    if (yCoord < -10) yCoord = -10;

    document.getElementById("x-val").textContent = xCoord.toFixed(2);
    document.getElementById("y-val").textContent = yCoord.toFixed(2);

    const canvas = document.getElementById("compass");
    const ctx = canvas.getContext("2d");

    const size = canvas.width; // 2000
    const center = size / 2;
    const step = size / 20; // 1 unità = 100px (per scala -10..+10)

    // === SFONDO GRIGLIA ===
    ctx.fillStyle = "#fafafa";
    ctx.fillRect(0, 0, size, size);
    ctx.strokeStyle = "#ccc";
    ctx.lineWidth = 3;

    // linee verticali/orizzontali
    for (let i = -10; i <= 10; i++) {
      const pos = center + i * step;
      // verticale
      ctx.beginPath();
      ctx.moveTo(pos, 0);
      ctx.lineTo(pos, size);
      ctx.stroke();
      // orizzontale
      ctx.beginPath();
      ctx.moveTo(0, pos);
      ctx.lineTo(size, pos);
      ctx.stroke();
    }

    // === ASSI CENTRALI ===
    ctx.strokeStyle = "#333";
    ctx.lineWidth = 6;

    // Asse X (economico)
    ctx.beginPath();
    ctx.moveTo(0, center);
    ctx.lineTo(size, center);
    ctx.stroke();

    // Asse Y (politico)
    ctx.beginPath();
    ctx.moveTo(center, 0);
    ctx.lineTo(center, size);
    ctx.stroke();

    // === ETICHETTE ===
    ctx.fillStyle = "#000";
    ctx.font = "80px Arial";
    ctx.textAlign = "center";
    ctx.fillText("Sinistra", center - 700, center + 100);
    ctx.fillText("Destra", center + 700, center + 100);
    ctx.rotate(-Math.PI / 2);
    ctx.fillText("Autoritarismo", -center, center - 700);
    ctx.rotate(Math.PI / 2);
    ctx.fillText("Libertarismo", center, center - 700);

    // === PUNTO UTENTE ===
    const px = center + xCoord * step;
    const py = center - yCoord * step;

    ctx.fillStyle = "#e74c3c";
    ctx.beginPath();
    ctx.arc(px, py, 40, 0, 2 * Math.PI);
    ctx.fill();

    // Cerchio nero attorno
    ctx.strokeStyle = "#000";
    ctx.lineWidth = 6;
    ctx.stroke();

    // === DOWNLOAD IMMAGINE ===
    document.getElementById("download-btn").addEventListener("click", () => {
      const link = document.createElement("a");
      link.download = "risultato_test_politico.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    });
  </script>
</body>
</html>

